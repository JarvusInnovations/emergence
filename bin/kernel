#!/usr/bin/env node

// requirements
var _ = require('underscore'),
    util = require('util'),
    url = require('url'),
    path = require('path'),
    fs = require('fs'),
    sitesLib = require('../kernel-lib/sites.js'),
    kernelConfig = require('/hab/svc/emergence-kernel/config/config.json');


// load core modules
var eSites = sitesLib.createSites(kernelConfig);
var eServices = require('../kernel-lib/services.js').createServices(eSites, kernelConfig);

// instantiate management server
var eManagementServer = require('../kernel-lib/server.js').createServer({
    sites: eSites,
    services: eServices
}, kernelConfig);


// start server
eManagementServer.start();

// handle exiting cleanly
process.on('SIGINT', function () {
    process.exit(2);
});

process.on('uncaughtException', function(error) {
    console.log('Uncaught Exception...');
    console.log(error.stack);
    process.exit(99);
});